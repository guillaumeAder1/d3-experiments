<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>My first d3.js</title>
</head>

<body>
    <div id="mySVG"></div>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script>


        var Loader = function(params){          
            return {
                params:null,
                svg:null,
                containerSize:null, 
                margin: 5,

                init: function(params){
                    this.params = params;
                    this.createSVG(params.container);
                    this.createDots(params.nrbDots, params.dotRadius);
                },

                createSVG: function(domNode){
                    var dom = (domNode) ? domNode : 'body';
                    // TODO change how to get the container Width/height
                    var element = document.querySelector(domNode);
                    this.containerSize = {
                        w: window.innerWidth,
                        h: window.innerHeight
                    };
                    this.svg = d3.select(dom)
                        .append("svg")
                        .attr("width", this.containerSize.w)
                        .attr("height", this.containerSize.h);
                },

                createDots: function(nbrDots, radius){
                    var circles = new Array(nbrDots).fill({
                        r:radius                      
                    });
                    var csCircles = circles.map(function(circle, index){
                        return {
                            r: circle.r,
                            cx: this._getXpos(index, nbrDots, radius, this.containerSize.w)
                        }                      
                    },this);

                    this.svg.selectAll('circle').data(csCircles).enter().append('circle')
                        .attr('r', function(d,i){return d.r})
                        .attr('cx', function(d,i){return d.cx})
                        .attr('cy',  10)
                        .text(function(d,i){return i})
                        
                        .style("fill" ,'red')
                },

                _getXpos: function(index, nbrDots, radius, dimenssion){
                    var center = (dimenssion / 2);
                    var offset = (radius * 2) + this.margin + 10;
                    var isEven = (nbrDots % 2 === 0) ? true : false;
                    if(isEven){
                        if(index < nbrDots/2){
                           var final = center - (offset * (nbrDots/2 - index)) 
                        } else {
                           var final = center + (offset * ((nbrDots/2 - index) + 1)) 
                        }
                    } // else TODO later for odd number
                    console.log(center, final + offset)
                    
                    return final + offset
                }
            }
           // init(param)
            function init (){
                alert('dsf')
            }

            var circles = [
                { cx: 0, cy: 20, r: 10 },
                { cx: 30, cy: 20, r: 10 },
                { cx: 60, cy: 20, r: 10 },
            ];
            var svg = d3.select("body")
                .append("svg")
                .attr("width", window.innerWidth)
                .attr("height", window.innerHeight);

            var t = d3.transition()
                .duration(750)
                .ease(d3.easeSinInOut).delay(500);
            var t2 = d3.transition()
                .duration(50)
                .ease(d3.easeSinInOut);

            var posx = 10;
            var circle = svg.selectAll('circle').data(circles).enter().append('circle')
                .attr('cx', function (d) { return d.cx })
                .attr('cy', function (d) { return d.cy })
                .attr('r', function (d) { return d.r })
                .transition(t)
                    .delay(function (d, i) { return 250 * i; }) // delay create animation async for each circle
                    .on('start', function repeat() {
                        //posx += 2;
                        d3.active(this) 
                            .style("opacity", "1") // first anim
                            .attr('r', 20)
                            .attr('cx' , function(d,i){return d.cx + 30})
                            .transition() 
                                .attr('r', 10)// second anim to go back to init postion
                                .style("opacity", "0") // first anim                            
                                .attr('cx', function(d,i){return d.cx + posx })
                            .transition() // repeat anim
                                .on('start', repeat);

                    })               



        }
       
        var myLoader = new Loader().init({
            nrbDots: 4,
            dotRadius: 10,
            container:'body'
        });
    </script>
</body>